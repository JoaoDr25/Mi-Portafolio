<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div class="contenidoFormulario">
        <div class="titulo">
            <h1>RESTAURANTE</h1>
        </div>

        <form id="formulario">
            <label for="numero"> <strong>Número de Mesa</strong></label>
            <input type="text" id="numero" class="numero" placeholder="Escriba el número de mesa">

            <label for="descripcion"> <strong>Descripción de la Mesa</strong></label>
            <input type="text" id="descripcion" class="descripcion" placeholder="Escriba la descripción de la mesa">

            <label for="personas"> <strong>Número de Personas</strong></label>
            <input type="text" id="personas" class="personas" placeholder="Escriba el número de personas">

            <label for="estado"> <strong>Estado de la Mesa</strong></label>
            <select name="estado" id="estado">
                <option value="">Seleccionar...</option>
                <option value="libre">Libre</option>
                <option value="ocupado">Ocupado</option>
                <option value="reservado">Reservado</option>
            </select>

            <div class="botones">
                <button id="registrar"><strong>GUARDAR MESA</strong></button>
            </div>
        </form>
    </div>

    <div id="modalMesas" class="modalMesas">
        <h2><strong>REGISTRO DE MESAS</strong></h2>


        <div id="buscarMesa">
            <label for="buscarMesa">Buscar Mesa: </label>
            <input type="search" id="buscarMesaInput" placeholder=" Buscar por # de Mesa">
        </div>

        <div id="mesas">

        </div>
    </div>

    <div id="modalConfirmarRegistro" class="modal-confirmacion">
        <div class="modal-contenido">
            <h3>Confirmar Registro</h3>
            <p>¿Estás seguro de que quieres guardar esta mesa?</p>
            <div class="modal-botones">
                <button id="btnConfirmarGuardar">Confirmar</button>
                <button id="btnCancelarGuardar">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalConfirmarEdicion" class="modal-confirmacion">
        <div class="modal-contenido">
            <h3>Confirmar Edición</h3>
            <p>¿Estás seguro de que quieres editar esta mesa?</p>
            <div class="modal-botones">
                <button id="btnConfirmarEditar">Confirmar</button>
                <button id="btnCancelarEditar">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalConfirmarEliminacion" class="modal-confirmacion">
        <div class="modal-contenido">
            <h3>Confirmar Eliminación</h3>
            <p>¿Estás seguro de que quieres eliminar esta mesa?</p>
            <div class="modal-botones">
                <button id="btnConfirmarEliminar">Confirmar</button>
                <button id="btnCancelarEliminar">Cancelar</button>
            </div>
        </div>
    </div>

    <div id="modalAlertaCamposVacios" class="modal-confirmacion">
        <div class="modal-contenido">
            <h3>Atención</h3>
            <p>Por favor, complete todos los campos.</p>
            <div class="modal-botones">
                <button id="btnCerrarAlertaCamposVacios">Cerrar</button>
            </div>
        </div>
    </div>

    <div id="modalAlertaMesaExistente" class="modal-confirmacion">
        <div class="modal-contenido">
            <h3>Atención</h3>
            <p>Ya existe una mesa con ese número. Ingrese otro número.</p>
            <div class="modal-botones">
                <button id="btnCerrarAlertaMesaExistente">Cerrar</button>
            </div>
        </div>
    </div>

</body>

<script>
    let datosMesa = []
    let modo = 0;
    let numeroMesa = "";
    let editandoMesa = "";

    const formulario = document.getElementById("formulario");
    const registrarBtn = document.getElementById("registrar");

    const modalConfirmarRegistro = document.getElementById("modalConfirmarRegistro");
    const btnConfirmarGuardar = document.getElementById("btnConfirmarGuardar");
    const btnCancelarGuardar = document.getElementById("btnCancelarGuardar");

    const modalConfirmarEdicion = document.getElementById("modalConfirmarEdicion");
    const btnConfirmarEditar = document.getElementById("btnConfirmarEditar");
    const btnCancelarEditar = document.getElementById("btnCancelarEditar");

    const modalConfirmarEliminacion = document.getElementById("modalConfirmarEliminacion");
    const btnConfirmarEliminar = document.getElementById("btnConfirmarEliminar");
    const btnCancelarEliminar = document.getElementById("btnCancelarEliminar");

    const modalAlertaCamposVacios = document.getElementById("modalAlertaCamposVacios");
    const btnCerrarAlertaCamposVacios = document.getElementById("btnCerrarAlertaCamposVacios");

    const modalAlertaMesaExistente = document.getElementById("modalAlertaMesaExistente");
    const btnCerrarAlertaMesaExistente = document.getElementById("btnCerrarAlertaMesaExistente");

    let mesaTemporal = null;
    let indiceTemporal = null;

    // Cargar datos del localStorage al iniciar
    document.addEventListener("DOMContentLoaded", () => {
        const datosGuardados = localStorage.getItem("datos");
        if (datosGuardados) {
            datosMesa = JSON.parse(datosGuardados);
            pintarMesas();
        }
    });

    registrarBtn.addEventListener("click", (event) => {
        event.preventDefault();

        const numeroInput = document.getElementById("numero").value.trim();
        const descripcionInput = document.getElementById("descripcion").value.trim();
        const personasInput = document.getElementById("personas").value.trim();
        const estadoInput = document.getElementById("estado").value;

        if (!numeroInput || !descripcionInput || !personasInput || !estadoInput) {
            modalAlertaCamposVacios.style.display = "block";
            return;
        }

        if (modo === 0) {
            const existe = datosMesa.some(m => m.numero === numeroInput);
            if (existe) {
                modalAlertaMesaExistente.style.display = "block";
                return;
            }
            mesaTemporal = {
                numero: numeroInput,
                descripcion: descripcionInput,
                personas: personasInput,
                estado: estadoInput
            };
            modalConfirmarRegistro.style.display = "block";
        } else if (modo === 1) {
            const existe = datosMesa.some((m, i) => m.numero === numeroInput && m.numero !== editandoMesa);
            if (existe) {
                modalAlertaMesaExistente.style.display = "block";
                return;
            }
            mesaTemporal = {
                numero: numeroInput,
                descripcion: descripcionInput,
                personas: personasInput,
                estado: estadoInput
            };
            modalConfirmarEdicion.style.display = "block";
        }
    });

    btnCerrarAlertaCamposVacios.addEventListener("click", () => {
      modalAlertaCamposVacios.style.display = "none";
    });

    btnCerrarAlertaMesaExistente.addEventListener("click", () => {
        modalAlertaMesaExistente.style.display = "none";
    });

    btnConfirmarGuardar.addEventListener("click", () => {
        if (mesaTemporal) {
            datosMesa.unshift(mesaTemporal);
            localStorage.setItem("datos", JSON.stringify(datosMesa));
            limpiar();
            pintarMesas();
            modalConfirmarRegistro.style.display = "none";
            mesaTemporal = null;
        }
    });

    btnCancelarGuardar.addEventListener("click", () => {
        modalConfirmarRegistro.style.display = "none";
        mesaTemporal = null;
    });

    btnConfirmarEditar.addEventListener("click", () => {
        if (mesaTemporal) {
            const indice = datosMesa.findIndex(it => it.numero === editandoMesa);
            if (indice !== -1) {
                datosMesa[indice].numero = mesaTemporal.numero;
                datosMesa[indice].descripcion = mesaTemporal.descripcion;
                datosMesa[indice].personas = mesaTemporal.personas;
                datosMesa[indice].estado = mesaTemporal.estado;

                localStorage.setItem("datos", JSON.stringify(datosMesa));

                modo = 0;
                editandoMesa = "";
                document.getElementById("registrar").textContent = "GUARDAR MESA";
                limpiar();
                pintarMesas();
                modalConfirmarEdicion.style.display = "none";
                mesaTemporal = null;
            }
        }
    });

    btnCancelarEditar.addEventListener("click", () => {
        modalConfirmarEdicion.style.display = "none";
        mesaTemporal = null;
    });

    btnConfirmarEliminar.addEventListener("click", () => {
        if (indiceTemporal !== null) {
            datosMesa.splice(indiceTemporal, 1);
            localStorage.setItem("datos", JSON.stringify(datosMesa));
            pintarMesas();
            modalConfirmarEliminacion.style.display = "none";
            indiceTemporal = null;
        }
    });

    btnCancelarEliminar.addEventListener("click", () => {
        modalConfirmarEliminacion.style.display = "none";
        indiceTemporal = null;
    });


    function pintarMesas(lista = datosMesa) {
        document.getElementById("mesas").textContent = ""
        lista.forEach((item, i) => {
            let divCard = document.createElement("div");
            divCard.id = "divCard"
            mesas.appendChild(divCard);

            if (item.estado === "libre") {
                divCard.style.backgroundColor = "#BDF057FF";
                divCard.style.borderColor = "#33460FFF";
            } else if (item.estado === "ocupado") {
                divCard.style.backgroundColor = "#F86666FF";
                divCard.style.borderColor = "#7A2A2AFF";
            } else if (item.estado === "reservado") {
                divCard.style.backgroundColor = "#FFD66DFF";
                divCard.style.borderColor = "#A37C18FF";
            }

            let numeroMesa = document.createElement("h4");
            numeroMesa.id = "numeroMesa"
            numeroMesa.textContent = `# ${item.numero}`;
            divCard.appendChild(numeroMesa);

            let imagenMesa = document.createElement("div");
            imagenMesa.id = "imagenMesa"
            let imagen = document.createElement("img");
            imagen.id = "mesa"
            imagen.src = "https://http2.mlstatic.com/D_Q_NP_2X_835035-MCO83954779410_042025-T.webp"
            imagenMesa.appendChild(imagen);
            divCard.appendChild(imagenMesa);

            let informacionMesa = document.createElement("div");
            informacionMesa.id = "informacionMesa"
            divCard.appendChild(informacionMesa);

            let descripcionMesa = document.createElement("p");
            descripcionMesa.id = "descripcionMesa"
            descripcionMesa.textContent = item.descripcion;
            informacionMesa.appendChild(descripcionMesa);

            let personasMesa = document.createElement("p");
            personasMesa.id = "personasMesa"
            personasMesa.textContent = `PERSONAS:  ${item.personas}`;
            informacionMesa.appendChild(personasMesa);

            let estadoMesa = document.createElement("p");
            estadoMesa.id = "estadoMesa"
            informacionMesa.appendChild(estadoMesa);

            let botonesMesa = document.createElement("div");
            botonesMesa.id = "botonesMesa"
            informacionMesa.appendChild(botonesMesa);

            let editarMesa = document.createElement("button");
            editarMesa.id = "botonEditar"
            editarMesa.textContent = "📚"
            botonesMesa.appendChild(editarMesa);
            editarMesa.addEventListener("click", () => {
                document.getElementById("numero").value = item.numero;
                document.getElementById("descripcion").value = item.descripcion;
                document.getElementById("personas").value = item.personas;
                document.getElementById("estado").value = item.estado;
                document.getElementById("registrar").textContent = "EDITAR MESA";
                modo = 1;
                editandoMesa = item.numero;
            })


            let eliminarMesa = document.createElement("button");
            eliminarMesa.id = "botonEliminar"
            eliminarMesa.textContent = "❌"
            botonesMesa.appendChild(eliminarMesa);
            eliminarMesa.addEventListener("click", () => {
                indiceTemporal = datosMesa.findIndex(it => it.numero == item.numero);
                modalConfirmarEliminacion.style.display = "block";
            })
        })
    }


    function limpiar() {
        document.getElementById("numero").value = "";
        document.getElementById("descripcion").value = "";
        document.getElementById("personas").value = "";
        document.getElementById("estado").value = "";
    }

    document.getElementById("buscarMesaInput").addEventListener("input", (e) => {
        let textoBusqueda = e.target.value.trim();

        if (textoBusqueda === "") {
            pintarMesas();
            return;
        }

        let mesasFiltradas = datosMesa.filter(mesa => mesa.numero.startsWith(textoBusqueda));
        pintarMesas(mesasFiltradas);
    });

</script>

<style>
    body {
        display: flex;
        justify-content: space-evenly;
        background-color: #ffffff;
    }

    .contenidoFormulario {
        width: 30%;
        margin-top: 70px;
        background-color: #fffcfc;
        border: 2px solid #5a3e36;
        border-radius: 10px;
        padding: 20px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
        height: fit-content;
    }

    .titulo h1 {
        display: flex;
        justify-content: center;
        font-family: 'Courier New', Courier, monospace;
        font-size: 3rem;
        color: #3f2c26;
    }

    #formulario {
        display: flex;
        flex-direction: column;
        width: 80%;
        justify-self: center;
    }

    #formulario label {
        font-family: math;
        padding-top: 10px;
        padding-bottom: 2px;
        font-size: 1.05rem;
    }

    #formulario input {
        height: 20px;
    }

    #formulario input::placeholder {
        font-size: 0.8rem;
    }

    #estado {
        height: 25px;
    }

    .botones {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .botones button:active {
        transform: translateY(1px);
        box-shadow: 0 2px #fdfdfd;
    }

    #registrar {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 0.8rem;
        margin: 20px 0 5px 0;
        width: 50%;
        padding: 4px;
        font-weight: bold;
        border-radius: 5px;
        cursor: pointer;
        color: #201613;
    }

    #verMesas {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 0.8rem;
        margin: 0 0 26px 0;
        width: 50%;
        font-weight: 500;
    }

    #modalMesas {
        width: 60%;
        background-color: #fffcfc;
        border: 2px solid #5a3e36;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }

    #modalMesas h2 {
        display: flex;
        justify-self: center;
        font-family: 'Courier New', Courier, monospace;
        margin-bottom: 10px;
        color: #3f2c26;
    }

    #buscarMesa {
        display: flex;
        justify-content: center;
        margin: 0 0 10px 10px;
        font-family: cursive;
    }

    #numeroMesa {
        display: flex;
        justify-content: center;
        margin: 15px 0 15px 0;
        font-size: 20px;
        font-family: cursive;
        font-weight: bold;
        padding: 3px;
    }

    #mesas {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr 1fr;
    }

    #divCard {
        display: flex;
        flex-direction: column;
        align-items: center;
        border: 2px solid black;
        border-radius: 10px;
        box-shadow: inset;
    }

    #imagenMesa {
        display: flex;
        justify-content: center;
    }

    #mesa {
        width: 160px;
        height: 160px;
        border-radius: 10px;
        border: 2px solid black;
    }

    #informacionMesa {
        width: 90%;
    }

    #informacionMesa p {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin-bottom: 0px;
    }

    #descripcionMesa {
        padding: 2px 0 2px 0;
        font-family: math;
        font-size: 0.9rem;
        text-transform: capitalize;
    }

    #personasMesa {
        font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-size: 0.9rem;
        margin-top: 8px;
        border-radius: 5px;
        padding: 2px;
    }

    #botonesMesa {
        padding: 0 0 13px 0;
        justify-self: center;
    }

    #botonesMesa button {
        background-color: rgb(224, 224, 224);
        box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        cursor: pointer;
        margin-right: 2px;
        margin-left: 2px;
    }

    #botonesMesa button:active {
        transform: translateY(1px);
        box-shadow: 0 2px #030303;
    }

    .modal-confirmacion {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-contenido {
        background-color: #fffcfc;
        border: 2px solid #5a3e36;
        padding: 20px;
        border-radius: 10px;
        width: 30%;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
    }

    .modal-contenido h3 {
        font-family: 'Courier New', Courier, monospace;
        color: #3f2c26;
        font-size: 1.5rem;
    }

    .modal-contenido p {
        font-family: math;
        font-size: 1.1rem;
        margin: 20px 0;
    }

    .modal-botones button {
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        font-size: 0.9rem;
        padding: 8px 15px;
        margin: 0 10px;
        border-radius: 5px;
        cursor: pointer;
        border: none;
    }

    #btnConfirmarGuardar,
    #btnConfirmarEditar,
    #btnConfirmarEliminar {
        background-color: #4CAF50;
        color: white;
    }

    #btnCerrarAlertaCamposVacios,
    #btnCerrarAlertaMesaExistente {
        background-color: #f44336;
        color: white;
    }

    #btnCancelarGuardar,
    #btnCancelarEditar,
    #btnCancelarEliminar {
        background-color: #f44336;
        color: white;
    }

    @media (max-width: 999px) {
        body {
            flex-direction: column;
            align-items: center;
            margin: 20px;
            gap: 10px;
        }

        .contenidoFormulario {
            width: 90%;
            margin-top: 20px;
            padding: 15px;
        }

        .titulo h1 {
            font-size: 2rem;
        }

        #formulario {
            width: 100%;
        }

        #registrar {
            width: 70%;
        }

        #modalMesas {
            width: 90%;
            padding: 15px;
        }

        #mesas {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        #divCard {
            flex-direction: row;
            text-align: left;
            padding: 10px;
        }

        #numeroMesa,
        #informacionMesa {
            margin: 0;
            padding-right: 15px;
        }

        #imagenMesa {
            margin-right: 15px;
        }

        #informacionMesa {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        #descripcionMesa,
        #personasMesa {
            text-align: left;
        }

        #botonesMesa {
            display: flex;
            justify-content: center;
            width: 100%;
            margin-top: 10px;
        }

        .modal-contenido {
            width: 85%;
            padding: 15px;
        }
    }

    @media (max-width: 480px) {
        #divCard {
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        #imagenMesa {
            margin-right: 0;
            margin-bottom: 10px;
        }

        #botonesMesa {
            justify-content: center;
        }
    }
</style>

</html>