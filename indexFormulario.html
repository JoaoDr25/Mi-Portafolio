<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styleFormulario.css">
  <title>Formulario de Registro</title>
</head>

<div class="bodyFormulario">

  <form class="formulario" id="formulario">
    <h2>REGISTRARSE</h2>
    <label for="nombres">NOMBRES</label>
    <input type="text" id="nombres" name="nombre">

    <label for="apellidos">APELLIDOS</label>
    <input type="text" id="apellidos" name="apellidos">

    <label for="tipoDocumento">TIPO DE DOCUMENTO</label>
    <select id="tipoDocumento" name="tipoDocumento">
      <option value="">Seleccionar...</option>
      <option value="tarjeta">Tarjeta de Identidad</option>
      <option value="cedula">C√©dula de Ciudadania</option>
      <option value="pasaporte">Pasaporte</option>
    </select>

    <label for="numeroDocumento">N√öMERO DE DOCUMENTO</label>
    <input type="text" inputmode="numeric" id="numeroDocumento" name="numeroDocumento">

    <label for="numeroTelefono">N√öMERO DE TELEFONO</label>
    <input type="tel" pattern="[0-9]{10}" id="telefono" name="telefono">

    <label for="email">EMAIL</label>
    <input type="email" id="email" name="email">

    <label for="FechaNacimiento">FECHA DE NACIMIENTO</label>
    <input type="date" id="fechaNacimiento" name="fechaNacimiento">

    <label for="genero">G√âNERO</label>
    <select id="genero" name="genero">
      <option value="">Seleccionar...</option>
      <option value="masculino">Masculino</option>
      <option value="femenino">Femenino</option>
      <option value="otro">Otro</option>
    </select>

    <div id="mensajeError" style="color: red; display: none;"></div>
    <div id="mensajeExito" style="color: rgb(8, 234, 8); display: none;"></div>

    <button type="submit"><strong>ENVIAR</strong></button>
    <button onclick="abrirModalTabla()" class="btnVerRegistros">REGISTROS</button>
  </form>


</div>

<div id="modalTabla" class="modal">
  <div class="modalContenido">
    <h1>REGISTROS</h1>
    <span class="cerrar" onclick="cerrarModalTabla()">&times;</span>
    <table border="1" id="tablaRegistros" style="justify-self: center;">
      <thead>
        <tr>
          <th>Item</th>
          <th>Nombres</th>
          <th>Apellidos</th>
          <th>Tipo Documento</th>
          <th>N√∫mero Documento</th>
          <th>Tel√©fono</th>
          <th>Email</th>
          <th>Fecha Nacimiento</th>
          <th>G√©nero</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>


<div id="modalConfirmarEnvio" class="modal">
  <div class="modalContenido">
    <p>¬øDeseas confirmar el env√≠o del formulario?</p>
    <button id="btnConfirmarEnvio">Confirmar</button>
    <button onclick="cerrarModalEnvio()">Cancelar</button>
  </div>
</div>


<div id="modalConfirmar" class="modal">
  <div class="modalContenido">
    <p>¬øDeseas eliminar este registro?</p>
    <button id="btnConfirmarEliminar">Eliminar</button>
    <button onclick="cerrarModalConfirmar()">Cancelar</button>
  </div>
</div>

<script>

  const formulario = document.querySelector("#formulario");
  const registros = [];
  let filaAEliminar = null;
  let filaEditando = null;

  formulario.addEventListener("submit", function (e) {
    e.preventDefault();

    const nuevoRegistro = {
      nombres: document.getElementById("nombres").value.trim(),
      apellidos: document.getElementById("apellidos").value.trim(),
      tipoDocumento: document.getElementById("tipoDocumento").value,
      numeroDocumento: document.getElementById("numeroDocumento").value.trim(),
      telefono: document.getElementById("telefono").value.trim(),
      email: document.getElementById("email").value.trim(),
      fechaNacimiento: document.getElementById("fechaNacimiento").value,
      genero: document.getElementById("genero").value
    };

    const errores = [];

    if (!nuevoRegistro.nombres) errores.push("Escriba los nombres.");
    if (!nuevoRegistro.apellidos) errores.push("Escriba los apellidos.");
    if (!nuevoRegistro.tipoDocumento) errores.push("Seleccione el tipo de documento.");
    if (!nuevoRegistro.numeroDocumento) errores.push("Escriba el n√∫mero de documento.");
    if (!nuevoRegistro.telefono) errores.push("Escriba el n√∫mero de tel√©fono.");
    if (!nuevoRegistro.email) errores.push("Escriba el email.");
    if (!nuevoRegistro.fechaNacimiento) errores.push("Seleccione la fecha de nacimiento.");
    if (!nuevoRegistro.genero) errores.push("Seleccione el g√©nero.");

    if (errores.length > 0) {
      if (errores.length === 1) {
        mostrarMensaje("error", errores[0]);
      } else {
        mostrarMensaje("error", "Por favor, completa todos los campos.");
      }
      return;
    }

    mostrarModalEnvio(nuevoRegistro);
  });

  function mostrarMensaje(tipo, mensaje) {
    const mensajeExito = document.getElementById("mensajeExito");
    const mensajeError = document.getElementById("mensajeError");

    if (tipo === "error") {
      mensajeError.textContent = mensaje;
      mensajeError.style.display = "block";
      mensajeExito.style.display = "none";
    } else {
      mensajeExito.textContent = mensaje;
      mensajeExito.style.display = "block";
      mensajeError.style.display = "none";
    }
  }

  function actualizarTabla() {
    const tablaBody = document.querySelector("#tablaRegistros tbody");
    tablaBody.innerHTML = "";

    registros.forEach((registro, index) => {
      let nuevaFila = document.createElement("tr");
      nuevaFila.innerHTML = generarHTMLFila(registro, index + 1);
      tablaBody.appendChild(nuevaFila);
    });
  }

  function generarHTMLFila(registro, index) {
    return `
    <td>${index}</td>
    <td>${registro.nombres}</td>
    <td>${registro.apellidos}</td>
    <td>${registro.tipoDocumento}</td>
    <td>${registro.numeroDocumento}</td>
    <td>${registro.telefono}</td>
    <td>${registro.email}</td>
    <td>${registro.fechaNacimiento}</td>
    <td>${registro.genero}</td>
    <td>
      <button onclick="editarRegistro(${index - 1})" title="Editar">‚úèÔ∏è</button>
      <button onclick="eliminarRegistro(${index - 1})" title="Eliminar">üóëÔ∏è</button>
    </td>`;
  }

  function editarRegistro(index) {
    const registroAEditar = registros[index];
    filaEditando = index;

    cerrarModalTabla();
    cerrarModalEnvio();
    cerrarModalConfirmar();

    document.getElementById("nombres").value = registroAEditar.nombres;
    document.getElementById("apellidos").value = registroAEditar.apellidos;
    document.getElementById("tipoDocumento").value = registroAEditar.tipoDocumento;
    document.getElementById("numeroDocumento").value = registroAEditar.numeroDocumento;
    document.getElementById("telefono").value = registroAEditar.telefono;
    document.getElementById("email").value = registroAEditar.email;
    document.getElementById("fechaNacimiento").value = registroAEditar.fechaNacimiento;
    document.getElementById("genero").value = registroAEditar.genero;

    mostrarMensaje("exito", "Registro cargado para edici√≥n.");
  }


  function eliminarRegistro(index) {
    filaAEliminar = index;
    document.getElementById("modalConfirmar").style.display = "block";
  }

  function cerrarModalConfirmar() {
    document.getElementById("modalConfirmar").style.display = "none";
    filaAEliminar = null;
  }

  document.getElementById("btnConfirmarEliminar").addEventListener("click", function () {
    if (filaAEliminar !== null) {
      registros.splice(filaAEliminar, 1);
      actualizarTabla();
    }
    cerrarModalConfirmar();
    mostrarMensaje("exito", "Registro eliminado correctamente.");
  });

  function mostrarModalEnvio(registro) {
    document.getElementById("modalConfirmarEnvio").style.display = "block";
    document.getElementById("btnConfirmarEnvio").onclick = () => {
      if (filaEditando !== null) {
        registros[filaEditando] = { ...registro };
        filaEditando = null;
        mostrarMensaje("exito", "Registro actualizado correctamente.");
      } else {
        registros.push(registro);
        mostrarMensaje("exito", "Formulario enviado correctamente. ¬°Gracias por registrarte!");
      }

      actualizarTabla();
      formulario.reset();
      cerrarModalEnvio();
    };
  }

  function cerrarModalEnvio() {
    document.getElementById("modalConfirmarEnvio").style.display = "none";
  }

  function abrirModalTabla() {
    document.getElementById("modalTabla").style.display = "block";
  }

  function cerrarModalTabla() {
    document.getElementById("modalTabla").style.display = "none";
  }

</script>

</body>

</html>